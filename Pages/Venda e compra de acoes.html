<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Venda/Compra de A√ß√µes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="logo">üí∞ Controla$$o</div>
    <nav>
      <a href="index.html">‚Üê Voltar</a>
    </nav>
  </header>

  <main class="container">
    <h2>üìä Venda/Compra de A√ß√µes</h2>
    <table border="1" cellspacing="0" cellpadding="6">
      <thead>
        <tr><th>C√≥digo</th><th>Tipo</th><th>Quantidade</th><th>Data</th><th>A√ß√µes</th></tr>
      </thead>
      <tbody id="operacoes-list">
        <!-- Linhas preenchidas pelo JS -->
      </tbody>
    </table>

    <h3>Registrar nova opera√ß√£o</h3>
    <form id="form-operacao">
      <label>Usu√°rio ID: <input type="number" id="usuario_operacao" required></label><br>
      <label>A√ß√£o ID: <input type="number" id="acao_operacao" required></label><br>
      <label>Quantidade: <input type="number" id="quantidade_operacao" required></label><br>
      <label>Tipo: 
        <select id="tipo_operacao" required>
          <option value="COMPRA">Compra</option>
          <option value="VENDA">Venda</option>
        </select>
      </label><br>
      <button type="submit">Adicionar</button>
    </form>
  </main>

  <footer>
    <p>&copy; 2025 Controla$$o</p>
  </footer>

  <script>
    const apiCompraVenda = 'http://localhost:8000/api/compras-vendas/';

    async function listarOperacoes() {
      const response = await fetch(apiCompraVenda);
      const operacoes = await response.json();

      const tbody = document.getElementById('operacoes-list');
      tbody.innerHTML = '';

      operacoes.forEach(op => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${op.acao}</td>
          <td>${op.tipo}</td>
          <td>${op.quantidade}</td>
          <td>${new Date(op.data).toLocaleDateString()}</td>
          <td>
            <button onclick="excluirOperacao(${op.id})">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function adicionarOperacao(dados) {
      const response = await fetch(apiCompraVenda, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(dados)
      });

      if (response.ok) {
        alert('Opera√ß√£o adicionada com sucesso!');
        listarOperacoes();
        document.getElementById('form-operacao').reset();
      } else {
        alert('Erro ao adicionar opera√ß√£o.');
      }
    }

    async function excluirOperacao(id) {
      if (!confirm('Confirma exclus√£o da opera√ß√£o?')) return;

      const response = await fetch(apiCompraVenda + id + '/', { method: 'DELETE' });

      if (response.ok) {
        alert('Opera√ß√£o exclu√≠da!');
        listarOperacoes();
      } else {
        alert('Erro ao excluir opera√ß√£o.');
      }
    }

    document.getElementById('form-operacao').addEventListener('submit', e => {
      e.preventDefault();
      const dados = {
        usuario: Number(document.getElementById('usuario_operacao').value),
        acao: Number(document.getElementById('acao_operacao').value),
        quantidade: Number(document.getElementById('quantidade_operacao').value),
        tipo: document.getElementById('tipo_operacao').value
      };
      adicionarOperacao(dados);
    });

    window.onload = listarOperacoes;
  </script>
</body>
</html>
