<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>A√ß√µes Favoritas</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="logo">üí∞ Controla$$o</div>
    <nav><a href="index.html">‚Üê Voltar</a></nav>
  </header>

  <main class="container">
    <h2>üìà A√ß√µes Favoritas</h2>

    <!-- Aqui a tabela ser√° preenchida dinamicamente -->
    <table id="tabela-favoritas" border="1" cellspacing="0" cellpadding="6">
      <thead>
        <tr>
          <th>A√ß√£o</th>
          <th>Pre√ßo Atual</th>
          <th>Data Atualiza√ß√£o</th>
          <th>Remover</th>
        </tr>
      </thead>
      <tbody>
        <!-- Linhas ser√£o inseridas aqui pelo JS -->
      </tbody>
    </table>
  </main>

  <footer>
    <p>&copy; 2025 Controla$$o</p>
  </footer>

  <script>
    const apiFavoritas = 'http://localhost:8000/api/favoritas/';
    const apiAcoes = 'http://localhost:8000/api/acoes/';

    // Vamos buscar as a√ß√µes favoritas e exibir na tabela
    async function carregarFavoritas() {
      try {
        // Pega as favoritas
        const resFav = await fetch(apiFavoritas);
        const favoritas = await resFav.json();

        // Pega as a√ß√µes para buscar os dados detalhados
        const resAcoes = await fetch(apiAcoes);
        const acoes = await resAcoes.json();

        const tbody = document.querySelector('#tabela-favoritas tbody');
        tbody.innerHTML = '';

        favoritas.forEach(fav => {
          // Acha a a√ß√£o correspondente para exibir nome e pre√ßo
          const acao = acoes.find(a => a.id === fav.acao);

          if (acao) {
            const tr = document.createElement('tr');

            tr.innerHTML = `
              <td>${acao.codigo} - ${acao.nome}</td>
              <td>R$ ${acao.preco_atual.toFixed(2)}</td>
              <td>${new Date(acao.data_atualizacao).toLocaleString()}</td>
              <td><button onclick="removerFavorita(${fav.id})">Remover</button></td>
            `;

            tbody.appendChild(tr);
          }
        });

      } catch (error) {
        console.error('Erro ao carregar a√ß√µes favoritas:', error);
      }
    }

    // Fun√ß√£o para remover uma a√ß√£o favorita
    async function removerFavorita(id) {
      if (!confirm('Tem certeza que deseja remover esta a√ß√£o favorita?')) return;

      try {
        const res = await fetch(apiFavoritas + id + '/', { method: 'DELETE' });
        if (res.ok) {
          alert('Favorita removida com sucesso!');
          carregarFavoritas();
        } else {
          alert('Erro ao remover favorita.');
        }
      } catch (error) {
        alert('Erro na comunica√ß√£o com o servidor.');
        console.error(error);
      }
    }

    // Carrega as favoritas ao abrir a p√°gina
    window.onload = carregarFavoritas;
  </script>
</body>
</html>
